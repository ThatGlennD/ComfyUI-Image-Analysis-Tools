# Image Analysis Toolkit

## Image Analysis Toolkit

The Image Analysis Toolkit is a suite of custom ComfyUI nodes built to evaluate and diagnose the technical qualities of images—especially those generated by AI models. Rather than creating visuals, these tools measure them, offering precise insights into sharpness, noise, exposure, color balance, and more.

Whether you’re tuning generation parameters, comparing model outputs, or building automated pipelines for quality assurance, this toolkit helps you make decisions grounded in data—not guesswork.

Each node focuses on a specific dimension of image quality and returns interpretable outputs that can be visualized, logged, or used downstream for filtering and refinement.

---

### Node Overview

| Node Name                   | Purpose                                                    | Primary Output(s)                              |
| --------------------------- | ---------------------------------------------------------- | ---------------------------------------------- |
| Sharpness / Focus Score     | Measures image focus using Laplacian, Tenengrad, or Hybrid | Sharpness score, annotated preview             |
| Blur Detection              | Detects and scores overall image blur                      | Blur score, blur map or annotated preview      |
| Noise Estimation            | Estimates visual noise levels in the image                 | Noise score, noise heatmap                     |
| Contrast Analysis           | Evaluates image contrast and tonal distribution            | Contrast score, histogram plot                 |
| Entropy Analysis            | Calculates informational density (bit entropy)             | Entropy score, heatmap, interpretation string  |
| Color Cast Detector         | Detects unbalanced RGB channels causing color shift        | Cast type, dominant shift, heatmap (optional)  |
| Color Temperature Estimator | Estimates average white point and Kelvin temperature       | Kelvin value, warmth label, visual swatch      |
| Clipping Analysis           | Detects highlight/shadow clipping or over-saturation       | Clipping mask, score, clipping type            |
| Edge Density Analysis       | Measures edge detail concentration via Canny or Sobel      | Edge score, edge map, heatmap                  |
| Color Harmony Analyzer      | Checks palette harmony (complementary, triadic, etc.)      | Harmony type, score, color wheel visualization |
| RGB Histogram Renderer      | Renders separate histograms for R, G, and B channels       | Histogram image                                |

---

### Sharpness / Focus Score

The Sharpness / Focus Score node measures the clarity of detail in an image using edge-based mathematical techniques. It helps detect soft or out-of-focus results that often arise from low step counts, diffusion noise, or poor prompt adherence.

This node supports three analysis methods, each based on a different algorithm for detecting image focus:

1. **Laplacian**

   * Applies the Laplacian operator (second derivative) to detect rapid intensity changes.
   * Measures the variance of the Laplacian response.
   * Higher variance = more fine detail and crisper edges.

2. **Tenengrad**

   * Computes the gradient magnitude using the Sobel operator.
   * Sums squared gradient magnitudes over the image.
   * Strong gradients suggest sharper edges.

3. **Hybrid**

   * Averages normalized Laplacian and Tenengrad scores.
   * Combines intensity variance and edge gradient strength.

**Outputs**

* Sharpness score (higher = sharper)
* Grayscale edge map (optional)

---

### Blur Detection

Identifies blur by analyzing edge strength across blocks using localized Laplacian variance.

**Block Size:** 8 to 128 pixels

* Smaller: More precise, slower
* Larger: Faster, less detailed

**Outputs**

* Blur score (0 to 1)
* Optional binary or heatmap blur map

---

### Noise Estimation

Analyzes visual noise by comparing original and blurred versions of an image.

**Block Size:** 8 to 128 pixels (default: 32)

**Outputs**

* Noise score (float, higher = more noise)
* Optional noise heatmap

---

### Contrast Analysis

Calculates image contrast using:

* Global, local, or hybrid scope
* Michelson, RMS, or Weber formulae

**Block Size:** 8 to 128 pixels

**Contrast Map:** Optional heatmap with left-side colorbar

**Outputs**

* Contrast score (float)
* Visual contrast map (optional)

---

### Entropy Analysis

Measures complexity using Shannon entropy in blocks (8-128 px).

**Entropy Map:** Optional heatmap showing detail variation

**Outputs**

* Entropy score (0-8 bits)
* Interpretation string (e.g., "High entropy (6.2 bits)")
* Optional entropy heatmap

---

### Color Cast Detector

Detects RGB imbalance via:

1. Channel difference
2. Neutrality deviation

**Tolerance:** 0.01–0.2 (default: 0.05)

**Outputs**

* Cast score
* Optional bias map
* Interpretation string

---

### Color Temperature Estimator

Estimates white point using Robertson approximation.

**Outputs**

* Kelvin value (e.g., 6643)
* Label (Warm, Neutral, etc.)
* Color swatch with overlaid label

---

### Clipping Analysis

Detects visual loss from:

1. Highlight/Shadow clipping
2. Saturation clipping

**Threshold:** 1–50 (default: 5)

**Outputs**

* Clipping score (float %)
* Clipping map (optional)
* Interpretation string

---

### Edge Density Analysis

Detects image edges via Canny or Sobel filters.

**Block Size:** 8–128 px

**Outputs**

* Edge density score (0–1)
* Edge map heatmap
* Raw edge preview
* Interpretation string

---

### Color Harmony Analyzer

Uses K-means clustering to detect dominant hues and compares against harmony models:

* Complementary
* Analogous
* Triadic
* Split-Complementary
* Tetradic
* Square

**Outputs**

* Harmony score (0.0–1.0)
* Harmony type
* Optional hue wheel

---

### RGB Histogram Renderer

Generates a histogram of RGB channel intensities.

**Outputs**

* Histogram image (256 bins/channel)
* X: normalized intensity (0–1)
* Y: pixel count or frequency


## Installation

To install the **ComfyUI Image Analysis Toolkit**, follow these steps:

### 1. Clone or Download

If not already cloned:

```bash
cd /path/to/ComfyUI/custom_nodes
git clone git@github.com:ThatGlennD/ComfyUI-Image-Analysis-Tools.git

cd ComfyUI-Image-Analysis-Tools
pip install -r requirements.txt
